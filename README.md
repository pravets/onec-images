# onec-images
Всё необходимое для сборки docker-образов с платформой 1С и сопутствующими инструментами.

## Оглавление

- [Как собрать образы](#как-собрать-образы)
    - [Сборка через GitHub Actions](#сборка-через-github-actions)
    - [Локальная сборка](#локальная-сборка)
- [1С:Исполнитель](#1сисполнитель)

## Как собрать образы

У вас есть 2 способа для сборки необходимых вам образов:

1. С помощью форка данного репозитория и сборки через [GitHub Actions](#сборка-через-github-actions) (предпочтительный вариант).
2. Клонирование и [локальная сборка](#локальная-сборка) на вашем компьютере. Сборка возможна только на ПК с ОС Linux.

[↑ Наверх](#onec-images)

### Сборка через GitHub Actions

1. Форкаем этот репозиторий.
2. Включаем GitHub Actions, если не включилось автоматически.
3. Пробрасываем в GitHub Actions необходимые секреты. В общем случае это:
    - `DOCKER_REGISTRY_URL` — адрес вашего приватного docker registry, куда будут запушены собранные образы.
    - `DOCKER_LOGIN` — логин для вашего registry.
    - `DOCKER_PASSWORD` — пароль для вашего registry.

4. "Навешиваем" нужные теги для триггера сборки. Если теги уже есть, предварительно их удаляем или пушим теги с --force. Теги можно "навешивать" на последний коммит или на последний релиз необходимого для сборки образа.
5. После завершения сборки получаем готовые образы в вашем registry.

[↑ Наверх](#onec-images)

### Локальная сборка

1. Клонируем репозиторий.
2. Копируем файл `.env.example` в `.env`.
3. Заполняем необходимые для сборки переменные среды в файле `.env`.
4. Запускаем скрипты для сборки нужных образов. Скрипты лежат в директории `src` и имеют имя вида `build-ОбразДляСборки.sh`.

[↑ Наверх](#onec-images)

## 1С:Исполнитель

Для сборки требуется также ключ API для скачивания установщика 1С:Исполнителя с сайта https://developer.1c.ru. Ключ необходимо записать в переменную среды/секрет `DEV1C_EXECUTOR_API_KEY`.

Триггером для сборки в Actions является тег вида `executor_ВерсияДляСборки`, например `executor_3.0.2.2`.

Скрипт для локальной сборки — `build-oscript.sh`.

[↑ Наверх](#onec-images)
